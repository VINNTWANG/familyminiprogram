<!-- pages/home/index.wxml -->
<view class="home-page">
  <!-- Custom Navigation Bar -->
  <nav nav-type="search" />

  <!-- Main Scrollable Area -->
  <scroll-view
    class="main-content"
    scroll-y
    refresher-enabled
    bindrefresherrefresh="onRefresherRefresh"
    refresher-triggered="{{isRefresherTriggered}}"
    bindscrolltolower="onReachBottom"
    bindscroll="onScroll"
    lower-threshold="200"
    scroll-top="{{scrollTop}}"
  >
    <!-- Loading Skeleton -->
    <block wx:if="{{isLoading}}">
      <view class="container">
        <post-skeleton />
        <post-skeleton />
      </view>
    </block>

    <!-- Main Content -->
    <block wx:else>
      <!-- Hero Section -->
      <view class="home-hero-wrapper">
        <view class="home-hero">
          <view class="user-info">
            <t-avatar size="large" image="{{userAvatarUrl}}" />
            <view class="user-texts">
      <view class="user-greeting">{{greetingText}}, {{userNickName}}</view>
              <view class="user-sub-greeting">{{activeGreetingSub}}</view>
            </view>
          </view>
          
        </view>
      </view>

      <!-- Banner Section -->
      <view class="home-banner">
        <swiper class="banner-swiper" indicator-dots autoplay circular interval="4000" duration="400">
          <block wx:for="{{banners}}" wx:key="*this" wx:for-index="i">
            <swiper-item>
              <image class="banner-img" src="{{item}}" mode="aspectFill" bindtap="onBannerTap" data-idx="{{i}}" lazy-load="true" />
            </swiper-item>
          </block>
        </swiper>
      </view>

            <!-- Quick Actions Grid -->
      <view class="quick-actions-container">
        <t-grid t-class="quick-actions-grid" column="{{3}}" border="{{false}}">
          <t-grid-item t-class="quick-action-item" text="{{i18n.publish}}" bind:click="goRelease">
            <t-icon name="edit-1" size="24" />
          </t-grid-item>
          <t-grid-item t-class="quick-action-item" text="{{i18n.family}}" bind:click="goFamily">
            <t-icon name="home" size="24" />
          </t-grid-item>
          <t-grid-item t-class="quick-action-item" text="{{i18n.remind}}" bind:click="goNotifications">
            <t-icon name="notification" size="24" />
          </t-grid-item>
        </t-grid>
      </view><!-- Post List -->
      <view class="post-list-container">
        <block wx:if="{{posts.length > 0}}">
          <view class="post-list">
            <block wx:for="{{posts}}" wx:key="_id">
              <view class="post-item-wrapper fade-up">
                <thread-item post="{{item}}" is-admin="{{isAdmin && item._openid === personalInfo._openid}}" bind:openDetail="openDetail" />
              </view>
            </block>
          </view>
          <!-- Load More / End of List -->
          <view class="list-footer">
            <t-loading wx:if="{{loadingMore}}" theme="spinner" text="加载中..." />
            <view wx:elif="{{!hasMore && posts.length > 5}}" class="end-of-list">没有更多</view>
          </view>
        </block>
        <!-- Empty State -->
        <block wx:else>
          <view class="empty-state">
            <t-empty description="还没有人发布动态，快来发布第一条吧" />
            <t-button t-class="empty-state-btn" theme="primary" shape="round" bindtap="goRelease">去发布</t-button>
          </view>
        </block>
      </view>
    </block>
  </scroll-view>

  <!-- Back to Top Button -->
  <view class="back-to-top-fab" wx:if="{{showBackTop}}" bindtap="backToTop">
    <t-icon name="arrow-up" size="24" />
  </view>

  <!-- Release FAB -->
  <view class="release-fab {{ releaseFabHidden ? 'is-hidden' : '' }}" bindtap="goRelease" animation="{{fabAnimation}}">
    <t-icon name="add" size="20" />
  </view>

  <!-- Global Message Component -->
  <t-message id="t-message" />
</view>

